---
description: >-
  microsoft powershell module use to manage and enumerate both Azure AD and
  Azure Resources
---

# Az Module

## Basics

* install the module

```powershell
Install-Module Az
```

* then login

```powershell
$creds=Get-Credential
Connect-AzAccount -Credential $creds

or 

$passwd = ConvertTo-SecureString "Mypassword" -AsPlainText -Force
$creds= New-ObjectSystem.Management.Automation.PSCredential("test@domain.onmicrosoft.com",$passwd)
Connect-AzAccount -Credential $creds 
```



> Az PowerShell can enumerate both Azure AD and Azure Resources. â€¢
>
> All the Azure AD cmdlets have the format _-AzAD_
>
> Get-Command _azad_
>
> Get-AzADUser
>
> Cmdlets for other Azure resources have the format _Az:_
>
> Get-Command _az_
>
> Get-AzResource
>
> Find cmdlets for a particular resource. For example, VMs:
>
> Get-Command _azvm_
>
> Get-Command -Noun _vm_ -Verb Get
>
> Get-Command _vm_

## Enumeration

* Situation awareness (account,tenant, subscription and roles)

```powershell
Get-AzContext
Get-AzContext -ListAvailable
Get-AzSubscription
Get-AzResource
Get-AzRoleAssignment
Get-AzRoleAssignment -SignInName test@domain.onmicrosoft.com
```

### Azure AD Users

```powershell
# get all users
Get-AzADUser 
# get a specific user
Get-AzADUser -UserPrincipalName test@domain.onmicrosoft.com 
# Search for a user string
Get-AzADUser -SearchString "admin"
Get-AzADUser| ?{$_.Displayname -match "admin"}
```

### Azure AD Groups

```powershell
# List all groups
Get-AzADGroup
# Specific group
Get-AzADGroup -ObjectId <ObjectID>
# Retrieve a group from which the DisplayName starts with "admin"
Get-AzADGroup -SearchString "admin" |fl*
# Search for a group from which the DisplayName contains "admin"
Get-AzADGroup|?{$_.Displayname -match "admin"}
# Specific group
Get-AzADGroupMember -ObjectId
```

### Azure AD Apps

```powershell
# Get all the application objects registered with the current tenant
# -> app registration in the portal
Get-AzADApplication
Get-AzADApplication -ObjectId <ObjectID>
# Search for an app using the displayname
Get-AzADApplication| ?{$_.DisplayName -match "app"} 
# Retrieve all the AD Apps with an application password
Get-AzADAppCredential
#List all the apps with an application password
Get-AzADApplication | %{if(Get-AzADAppCredential -ObjectID $_.ObjectID){$_}}

# Retrieve Function Apps
Get-AzFunctionApp 
```

### Azure AD Service principals

```powershell
# Get all service principals
Get-AzADServicePrincipal
Get-AzADServicePrincipal -ObjectId <ObjectID>

Get-AzADServicePrincipal |?{$_.DisplayName -match "app"}
```

### Storage account

```powershell
Get-AzStorageAccount
```

KeyVault

```powershell
Get-AzKeyVault
```
