---
description: >-
  used to create and manage Azure resources:
  https://docs.microsoft.com/en-us/cli/azure/install- azure-cli
---

# Azure CLI (DOS and powershell)

## Basic

> Can be used in DOS as well
>
> ![](<../../../../../.gitbook/assets/image (2).png>)

* Get help for commands

```powershell
az find "vm"
az find "az vm"
# Get help for some subcommands
az find "az vm list"

# change the output format :
 --output table

```

## Login

```powershell
az login

# or using creds via command line 
az login -u test@domain.onmicrosoft.com -p <PASSWORD>

# If the user has no permission on the subscription
az login -u test@domain.onmicrosoft.com -p <PASSWORD> --allow-no-subscriptions

```

## Enumeration

### Situation awarness

```powershell
# tenant 
az account tenant list
# subscription
az account subscription list
# current signin user
az ad signed-in-user show
```

### Users related

```powershell
az ad user list --output table

# List all users, selection only GivenName and userPrincipalName
az ad user list --query "[].[userPrincipalName,displayName]" --output table

az ad user list
az ad user list --query "[].[displayName]" -o table

# Enumerate a specific user (lists all attributes)
az ad user show --id test@defcorphq.onmicrosoft.com

# Search for a user which contains admin in his DisplayName
az ad user list --query "[?contains(displayName,'admin')].displayName"
# or 
az ad user list | ConvertFrom-Json | %{$_.displayName -match
"admin"}

# Users which are sync On-Prem
az ad user list --query "[?onPremisesSecurityIdentifier!=null].displayName"

# and Users which are from Azure AD
az ad user list --query "[?onPremisesSecurityIdentifier==null].displayName"
```

### Groups

```powershell
# list all groups
az ad group list
az ad group list --query "[].[displayName]" -o table

# a specific group
az ad group show -g "VM Admins"
az ad group show -g <ID>

# Search for groups which contains the word "Admin" in the DisplayName
az ad group list --query "[?contains(displayName,'admin')].displayName"
# same using powershell
az ad group list | ConvertFrom-Json | %{$_.displayName -match "admin"}

# Groups which are sync On-Prem
az ad group list --query "[?onPremisesSecurityIdentifier!=null].displayName"

# Groups which are from Azure AD
az ad group list --query "[?onPremisesSecurityIdentifier==null].displayName"
```
