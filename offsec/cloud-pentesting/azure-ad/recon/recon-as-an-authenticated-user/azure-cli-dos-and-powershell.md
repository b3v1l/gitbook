---
description: >-
  used to create and manage Azure resources:
  https://docs.microsoft.com/en-us/cli/azure/install- azure-cli
---

# Azure CLI (DOS and powershell)

## Basic

> Can be used in DOS as well
>
> ![](<../../../../../.gitbook/assets/image (11).png>)

* Get help for commands

```powershell
az find "vm"
az find "az vm"
# Get help for some subcommands
az find "az vm list"

# change the output format :
 --output table

```

## Login

```powershell
az login

# or using creds via command line 
az login -u test@domain.onmicrosoft.com -p <PASSWORD>

# If the user has no permission on the subscription
az login -u test@domain.onmicrosoft.com -p <PASSWORD> --allow-no-subscriptions

```

## Enumeration

### Situation awarness

```powershell
# tenant 
az account tenant list
# subscription
az account subscription list
# current signin user
az ad signed-in-user show
```

### Users related

```powershell
az ad user list --output table

# List all users, selection only GivenName and userPrincipalName
az ad user list --query "[].[userPrincipalName,displayName]" --output table

az ad user list
az ad user list --query "[].[displayName]" -o table

# Enumerate a specific user (lists all attributes)
az ad user show --id test@defcorphq.onmicrosoft.com

# Search for a user which contains admin in his DisplayName
az ad user list --query "[?contains(displayName,'admin')].displayName"
# or 
az ad user list | ConvertFrom-Json | %{$_.displayName -match
"admin"}

# Users which are sync On-Prem
az ad user list --query "[?onPremisesSecurityIdentifier!=null].displayName"

# and Users which are from Azure AD
az ad user list --query "[?onPremisesSecurityIdentifier==null].displayName"
```

### Groups

```powershell
# list all groups
az ad group list
az ad group list --query "[].[displayName]" -o table

# a specific group
az ad group show -g "VM Admins"
az ad group show -g <ID>

# Search for groups which contains the word "Admin" in the DisplayName
az ad group list --query "[?contains(displayName,'admin')].displayName"
# same using powershell
az ad group list | ConvertFrom-Json | %{$_.displayName -match "admin"}

# Groups which are sync On-Prem
az ad group list --query "[?onPremisesSecurityIdentifier!=null].displayName"

# Groups which are from Azure AD
az ad group list --query "[?onPremisesSecurityIdentifier==null].displayName"
```

### Azure  AD Apps

**Note: Application Registration in Azure Portal**

<pre class="language-powershell"><code class="lang-powershell"><strong># Get all the application objects registered with the current tenant
</strong>az ad app list
az ad app list --query "[].[displayName]" -o table

# Get details for a specific app
az ad app show --id &#x3C;ID>

# Search based on the DisplayName
az ad app list --query "[?contains(displayName,'app')].displayName"

# same using powershell 
az ad app list | ConvertFrom-Json | %{$_.displayName -match "app"}

# get Owner of a specific app
az ad app owner list --id &#x3C;ID> --query "[].[displayName]" -o table

# List apps which have credential password
az ad app list --query "[?passwordCredentials !=null].displayName"

# Search for apps which are using Certificates to authenticate
az ad app list --query "[?keyCredentials !=null].displayName"
</code></pre>

### Azure AD Service Principals

**Note: Enterprise Applications in Azure Portal**

```powershell
# Get Service Principal
az ad sp list --all
az ad sp list --all --query "[].[displayName]" -o table

# Get SP details using SP ID or ObjectID
az ad sp show --id <ID>

# Search for SP based on his name
az ad sp list --all --query "[?contains(displayName,'app')].displayName"
# Same with powershell
az ad sp list --all | ConvertFrom-Json | %{$_.displayName -match "app"}

# Search Owner of a SP
az ad sp owner list --id <ID> --query "[].[displayName]" -o table

# Retrieve SP owned by the curent user
az ad sp list --show-mine

# List SP which have a password
az ad sp list --all --query "[?passwordCredentials != null].displayName"
# Same but using a certificate to authenticate
az ad sp list -all --query "[?keyCredentials != null].displayName"
```

### Few examples

```powershell
# get all the VM, getting only the names
 az vm list --query "[].[name]" -o table
 
# Get the Web Apps
az webapp list --query "[].[name]" -o table

# Function App
az functionapp list --query "[].[name]" -o table

# Storage account
az storage list --query "[].[name]" -o table

# Key Vault
az keyvault list
```
