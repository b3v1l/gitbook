# Tokens and CLI tools

## Overview

Authentication can be done using Az Powershell or AzureAD module.

## Conditional Access Policy

Policies created to enforce security when some conditions are met :

<figure><img src="../../../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

For instance, a conditional access policy can block a Azure AD login from an unknown computer.

This can be bypassed using token based authentication





## Az PowerShell

### Access token for resource manager (ARM)

> must be connected to a tenant

#### Request an access token

```powershell
Get-AzAccessToken
# formated output
(Get-AzAccessToken).Token
```

#### Authenticate using the token

> If an attacker is able to generate or steal a token, he'll able to login from an untrusted computer.

```powershell
# Usage 
Connect-AzAccount -AccountId test@domain.onmicrosoft.com -AccessToken ey<SNIP>..
```

#### Request an access token for a resource

```powershell
# Request a token for a specific resource

Get-AzAccessToken -ResourceTypeName MSGraph

# for older version
(Get-AzAccessToken -Resource "https://graph.microsoft.com").Token
```
