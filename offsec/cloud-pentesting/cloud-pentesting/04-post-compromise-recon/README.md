# 04-Post-compromise Recon

## Enumerating Access

### AWS

Clone the repo and export Env Variables

```csharp
git clone https://github.com/carnal0wnage/weirdAAL
export AWS_ACCESS_KEY_ID= XXXXXXXXXX
export AWS_SECRET_ACCESS_KEY= XXXXXXXXXXX

python3 weirdAAL.py -m recon_all -t test
```

![](../../../../.gitbook/assets/b7c56a14b3ea4f95b5b37eb98f8ddd6c.png)

#### Resource 

{% embed url="https://github.com/carnal0wnage/weirdAAL" %}

### Google

* Clone ScoutSuite repo

```text
git clone https://github.com/nccgroup/ScoutSuite
```

* Run it

```text
$ virtualenv -p python3 venv
$ source venv/bin/activate
$ pip install scoutsuite
$ scout --help
```

![](../../../../.gitbook/assets/bbf7de0081144c7894b022f03e909b94.png)

#### Resource

{% embed url="https://github.com/nccgroup/ScoutSuite" %}

### Azure

Info that can be useful to retrieve :

* User info
* Subscription info
* Resource Groups
* Creds in Runbooks

Tenant = Azure Active Directory

Runbooks = Azure tasks automation

If DirSync is enable, bloodhound can be used to retrieve on premise AD info

#### Subscription Roles

| Roles | access |
| :--- | :--- |
| Owner | Full control |
| Contributor | Everything but permissions change |
| Reader | Read Attributes |
| User Access Admin | Manage user access to Azure resources |

![](../../../../.gitbook/assets/361df31f727b45cfb79903dab51952e4.png)



## Azure CLI Enumeration

### Az Module

* Connect to Azure 

```text
Connect-AzAccount
```

* Get current user's role

```text
Get-AzRoleAssignment
```

![](../../../../.gitbook/assets/c23edbcad47e434f906d329f453e2065.png)

Note: if the Azure portal is locked down MSonline can be used to retrieve user information

### MSOnline module

* Connecto to MSOnline service 

```csharp
Connect-MSolService
```

* Retrieve users and group 

```csharp
get-MSolUser -All
get-MSolGroup -All 
get-MSolGroupMember -GroupObjectId <GUID>
```

### Resources

{% embed url="https://github.com/hausec/PowerZure" %}

{% embed url="https://github.com/NetSPI/MicroBurst" %}

{% embed url="https://github.com/dirkjanm/BloodHound-AzureAD" %}

{% embed url="https://github.com/dirkjanm/ROADtools" %}









