# SSRF exploitation

## SSRF (service side request forgery)

Can be used to :

* cause the webapp to send web request to a controlled domain
* Steal MetaData instance

## SSRF POC

We have compromised an AWS account :

### Create a profil

```csharp
aws configure --profile=solus
```

### Try to list Instances

```csharp
aws ec2 describe-instances --region=us-east-1 --profile=solus
```

User doesn't the permission to list instance ...

### Try to list lambda functions

```csharp
aws lambda list-functions  --region=us-east-1 --profile=solus
```

![](<../../../../../.gitbook/assets/image (182).png>)

We can read lambda functions and retrieve an another key

### Set up the account

![](<../../../../../.gitbook/assets/image (226).png>)

### Try to list instances

```csharp
aws ec2 describe-instances --profile=polo --region=us-east-1
```

![](<../../../../../.gitbook/assets/image (72).png>)

### Use the public IP to connect

![](<../../../../../.gitbook/assets/image (242).png>)

### SSRF exploit&#x20;

Using this vulnerability on the web application, where are able to retrieve server MetaData

![](<../../../../../.gitbook/assets/image (146).png>)

![](<../../../../../.gitbook/assets/image (51).png>)

### Retrieve new credentials

Using the security-credentials, we are able to retrieve the Accesskey and secret :

![](<../../../../../.gitbook/assets/image (13).png>)

### Resources

{% embed url="https://github.com/RhinoSecurityLabs/cloudgoat" %}
