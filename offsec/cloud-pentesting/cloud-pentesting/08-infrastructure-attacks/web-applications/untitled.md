# SSRF exploitation

## SSRF \(service side request forgery\)

Can be used to :

* cause the webapp to send web request to a controlled domain
* Steal MetaData instance

## SSRF POC

We have compromised an AWS account :

### Create a profil

```csharp
aws configure --profile=solus
```

### Try to list Instances

```csharp
aws ec2 describe-instances --region=us-east-1 --profile=solus
```

User doesn't the permission to list instance ...

### Try to list lambda functions

```csharp
aws lambda list-functions  --region=us-east-1 --profile=solus
```

![](../../../../../.gitbook/assets/image%20%28182%29.png)

We can read lambda functions and retrieve an another key

### Set up the account

![](../../../../../.gitbook/assets/image%20%28226%29.png)

### Try to list instances

```csharp
aws ec2 describe-instances --profile=polo --region=us-east-1
```

![](../../../../../.gitbook/assets/image%20%2872%29.png)

### Use the public IP to connect

![](../../../../../.gitbook/assets/image%20%28242%29.png)

### SSRF exploit 

Using this vulnerability on the web application, where are able to retrieve server MetaData

![](../../../../../.gitbook/assets/image%20%28146%29.png)

![](../../../../../.gitbook/assets/image%20%2851%29.png)

### Retrieve new credentials

Using the security-credentials, we are able to retrieve the Accesskey and secret :

![](../../../../../.gitbook/assets/image%20%2813%29.png)

### Resources

{% embed url="https://github.com/RhinoSecurityLabs/cloudgoat" %}

